import{a as te}from"./chunk-B6GHM2N4.js";import{a as ie}from"./chunk-ZKLHUJ5Z.js";import{a as ee}from"./chunk-QUF2MSQX.js";import"./chunk-QFI5ZUMR.js";import{C as $,r as J,u as K,x as Y,z as Z}from"./chunk-JEBJIWP7.js";import{D as Q,G as X,e as N,i as j,j as O,k as V,l as G,m as P,n as z,o as A,p as W,t as B,u as L,x as U,z as H}from"./chunk-WBYHU4V7.js";import{$ as h,F as p,G as f,P as c,Q as d,S as b,W as g,Wa as I,ca as n,da as a,db as E,ea as T,eb as D,ia as _,ja as x,ka as m,lb as M,pb as F,ta as s,va as w,wa as y,xa as C,xb as q,ya as k,yb as R}from"./chunk-TPGHJTJC.js";import"./chunk-SRKNPOHE.js";import"./chunk-7KGURMOZ.js";import"./chunk-BLW5R4XS.js";import"./chunk-XPWJSSAW.js";import"./chunk-WNRD3PDI.js";import"./chunk-QQJWOYZO.js";import"./chunk-MHO3CSUV.js";import"./chunk-4WFVMWDK.js";import"./chunk-XDPEVTHG.js";import"./chunk-NMYJD6OP.js";import"./chunk-C5RQ2IC2.js";import"./chunk-7D2EH4XU.js";import"./chunk-MMIXVVWR.js";import"./chunk-SV7S5NYR.js";import{a as v,b as S,g as u}from"./chunk-PM2M367S.js";function oe(l,t){if(l&1){let e=_();n(0,"ion-label"),s(1,"Fr\xE9quence :"),a(),n(2,"ion-select",9),k("ngModelChange",function(i){p(e);let r=m();return C(r.task.frequency,i)||(r.task.frequency=i),f(i)}),n(3,"ion-select-option",10),s(4,"Aucun"),a(),n(5,"ion-select-option",11),s(6,"Quotidien"),a(),n(7,"ion-select-option",12),s(8,"Hebdomadaire"),a(),n(9,"ion-select-option",13),s(10,"Mensuel"),a(),n(11,"ion-select-option",14),s(12,"Annuel"),a()()}if(l&2){let e=m();c(2),y("ngModel",e.task.frequency)}}function ae(l,t){if(l&1){let e=_();n(0,"ion-label"),s(1," Date d'ex\xE9cution :"),a(),n(2,"ion-datetime",15),k("ngModelChange",function(i){p(e);let r=m();return C(r.task.dueDate,i)||(r.task.dueDate=i),f(i)}),a()}if(l&2){let e=m();c(2),y("ngModel",e.task.dueDate)}}function re(l,t){if(l&1){let e=_();n(0,"ion-button",7),x("click",function(){p(e);let i=m();return f(i.addTask(i.task))}),s(1,"Ajouter la t\xE2che"),a()}}var ne=class l{constructor(t,e,o,i,r,le){this._activeRoute=t;this._firestore=e;this._famillyService=o;this._databaseService=i;this._router=r;this._taskSelectionService=le}task=null;taskDescription=null;famillyGroupName=null;ngOnInit(){return u(this,null,function*(){this.famillyGroupName=yield this._famillyService.getFamillyGroupName(),this.getTask()})}getTask(){return u(this,null,function*(){let t=this._activeRoute.snapshot.paramMap.get("taskId");try{if(t){if(!this.famillyGroupName)throw new Error("Familly group not found");let e=K(this._firestore,"Familly",this.famillyGroupName,"Tasks"),o=Z(e,$("uuid","==",t)),i=yield Y(o);if(!i.empty)i.forEach(r=>{this.task=r.data(),this.taskDescription=r.get("description")});else{console.log("Task not found in Firestore. Switching to local database");let r=yield this._databaseService.getTask(t,this.famillyGroupName);r&&(this.task=r,this.taskDescription=r.description),console.log("Getting tasks from the local database:",this.task)}}}catch(e){console.error("Error getting task:",e)}})}addTask(t){return u(this,null,function*(){t.frequency=t.frequency||"none",t.frequency==="none"?yield this._taskSelectionService.addTask(t):yield this.handleRepeatingTask(t)})}handleRepeatingTask(t){return u(this,null,function*(){let e=new Date(t.dueDate);for(let o=0;o<10;o++){t.frequency==="daily"?e.setDate(e.getDate()+1):t.frequency==="weekly"?e.setDate(e.getDate()+7):t.frequency==="monthly"&&e.setMonth(e.getMonth()+1);let i=S(v({},t),{uuid:this.generateUUID(),dueDate:e.toISOString().split("T")[0]});yield this._taskSelectionService.addTask(i)}})}generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{let e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}backToCat(){this._router.navigate(["category"])}static \u0275fac=function(e){return new(e||l)(d(E),d(J),d(ee),d(ie),d(D),d(te))};static \u0275cmp=b({type:l,selectors:[["app-chore-edition"]],decls:18,vars:4,consts:[[1,"ion-text-center","headerToolbar"],[1,"headerTitle"],[1,"editionContainer"],[1,"ion-padding"],[1,"ion-justify-content-center","ion-align-items-center"],["sizeXs","10","sizeSm","8","sizeMd","6","sizeLg","4",1,"ion-padding"],["slot","fixed","vertical","bottom","horizontal","end"],[3,"click"],["src","./Illustrations/Menu/chore_home_menu_icon.webp"],["aria-label","frequency","id","frequency","name","frequency","interface","popover","placeholder","Choisir une fr\xE9quence",3,"ngModelChange","ngModel"],["value","none"],["value","daily"],["value","weekly"],["value","monthly"],["value","yearly"],["aria-label","dueDate","id","dueDate","name","dueDate","locale","fr-FR","presentation","date",3,"ngModelChange","ngModel"]],template:function(e,o){e&1&&(n(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-text",1),s(3),a()()(),n(4,"ion-content")(5,"div",2)(6,"ion-grid",3)(7,"ion-row",4)(8,"ion-col",5),g(9,oe,13,1),a()(),n(10,"ion-row",4)(11,"ion-col",5),g(12,ae,3,1),a()(),n(13,"ion-row",4),g(14,re,2,0,"ion-button"),a()(),n(15,"ion-fab",6)(16,"ion-fab-button",7),x("click",function(){return o.backToCat()}),T(17,"ion-img",8),a()()()()),e&2&&(c(3),w(" ",o.taskDescription," "),c(6),h(o.task?9:-1),c(3),h(o.task?12:-1),c(2),h(o.task?14:-1))},dependencies:[I,R,M,q,F,O,P,j,B,z,H,U,X,L,W,Q,N,V,G,A],styles:["ion-content[_ngcontent-%COMP%]{--background: #fcf8ed}ion-toolbar.headerToolbar[_ngcontent-%COMP%]{--background: #e76f51}ion-text.headerTitle[_ngcontent-%COMP%]{color:#264653;font-family:Roboto,sans-serif;font-weight:700;font-size:1.3rem}div.editionContainer[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;height:100%}"]})};export{ne as ChoreEditionComponent};
