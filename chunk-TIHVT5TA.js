import{a as ne}from"./chunk-3KVAIWYK.js";import{a as oe}from"./chunk-G6NVH6ZR.js";import{a as ie}from"./chunk-WVY745H3.js";import"./chunk-WJDDQXF5.js";import{C as te,r as Y,u as Z,x as $,z as ee}from"./chunk-JOGVLLNH.js";import{A as f,Ba as I,Cb as K,G as c,Ga as D,H as m,Ha as M,I as b,K as g,La as R,N as T,O as _,Pa as F,R as n,S as a,T as w,Ta as q,Ua as V,V as x,W as h,X as d,Za as j,bb as N,cb as O,db as G,ea as l,eb as P,ga as E,ha as y,hb as z,ia as C,ib as B,ja as k,jb as A,kb as W,ob as L,pb as U,sb as H,ub as Q,vb as X,z as p,zb as J}from"./chunk-SPIVRC24.js";import"./chunk-SRKNPOHE.js";import"./chunk-7KGURMOZ.js";import"./chunk-BLW5R4XS.js";import"./chunk-XPWJSSAW.js";import"./chunk-WNRD3PDI.js";import"./chunk-QQJWOYZO.js";import"./chunk-MHO3CSUV.js";import"./chunk-4WFVMWDK.js";import"./chunk-XDPEVTHG.js";import"./chunk-NMYJD6OP.js";import"./chunk-C5RQ2IC2.js";import"./chunk-7D2EH4XU.js";import"./chunk-MMIXVVWR.js";import"./chunk-SV7S5NYR.js";import{a as v,b as S,g as u}from"./chunk-PM2M367S.js";function re(s,t){if(s&1){let e=x();n(0,"ion-label"),l(1,"Fr\xE9quence :"),a(),n(2,"ion-select",9),k("ngModelChange",function(i){p(e);let r=d();return C(r.task.frequency,i)||(r.task.frequency=i),f(i)}),n(3,"ion-select-option",10),l(4,"Aucun"),a(),n(5,"ion-select-option",11),l(6,"Quotidien"),a(),n(7,"ion-select-option",12),l(8,"Hebdomadaire"),a(),n(9,"ion-select-option",13),l(10,"Mensuel"),a(),n(11,"ion-select-option",14),l(12,"Annuel"),a()()}if(s&2){let e=d();c(2),y("ngModel",e.task.frequency)}}function se(s,t){if(s&1){let e=x();n(0,"ion-label"),l(1," Date d'ex\xE9cution :"),a(),n(2,"ion-datetime",15),k("ngModelChange",function(i){p(e);let r=d();return C(r.task.dueDate,i)||(r.task.dueDate=i),f(i)}),a()}if(s&2){let e=d();c(2),y("ngModel",e.task.dueDate)}}function le(s,t){if(s&1){let e=x();n(0,"ion-button",16),h("click",function(){p(e);let i=d();return f(i.addTask(i.task))}),l(1,"Ajouter la t\xE2che"),a(),n(2,"ion-toast",17),h("didDismiss",function(i){p(e);let r=d();return f(r.setRoleMessage(i))}),a()}if(s&2){let e=d();c(2),T("buttons",e.toastButtons)("duration",2e3)}}var ae=class s{constructor(t,e,o,i,r,ce){this._activeRoute=t;this._firestore=e;this._famillyService=o;this._databaseService=i;this._router=r;this._taskSelectionService=ce}task=null;taskDescription=null;famillyGroupName=null;toastButtons=[{text:"Retirer",role:"cancel",handler:()=>{console.log("Dismiss clicked")}}];setRoleMessage(t){let{role:e}=t.detail;console.log(`Dismissed with role: ${e}`)}ngOnInit(){return u(this,null,function*(){this.famillyGroupName=yield this._famillyService.getFamillyGroupName(),this.getTask()})}getTask(){return u(this,null,function*(){let t=this._activeRoute.snapshot.paramMap.get("taskId");try{if(t){if(!this.famillyGroupName)throw new Error("Familly group not found");let e=Z(this._firestore,"Familly",this.famillyGroupName,"Tasks"),o=ee(e,te("uuid","==",t)),i=yield $(o);if(!i.empty)i.forEach(r=>{this.task=r.data(),this.taskDescription=r.get("description")});else{console.log("Task not found in Firestore. Switching to local database");let r=yield this._databaseService.getTask(t,this.famillyGroupName);r&&(this.task=r,this.taskDescription=r.description),console.log("Getting tasks from the local database:",this.task)}}}catch(e){console.error("Error getting task:",e)}})}addTask(t){return u(this,null,function*(){t.frequency=t.frequency||"none",t.frequency==="none"?yield this._taskSelectionService.addTask(t):yield this.handleRepeatingTask(t)})}handleRepeatingTask(t){return u(this,null,function*(){let e=new Date(t.dueDate);for(let o=0;o<10;o++){t.frequency==="daily"?e.setDate(e.getDate()+1):t.frequency==="weekly"?e.setDate(e.getDate()+7):t.frequency==="monthly"&&e.setMonth(e.getMonth()+1);let i=S(v({},t),{uuid:this.generateUUID(),dueDate:e.toISOString().split("T")[0]});yield this._taskSelectionService.addTask(i)}})}generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{let e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}backToCat(){this._router.navigate(["category"])}static \u0275fac=function(e){return new(e||s)(m(D),m(Y),m(ie),m(oe),m(M),m(ne))};static \u0275cmp=b({type:s,selectors:[["app-chore-edition"]],decls:18,vars:4,consts:[[1,"ion-text-center","headerToolbar"],[1,"headerTitle"],[1,"editionContainer"],[1,"ion-padding"],[1,"ion-justify-content-center","ion-align-items-center"],["sizeXs","10","sizeSm","8","sizeMd","6","sizeLg","4",1,"ion-padding"],["slot","fixed","vertical","bottom","horizontal","end"],[3,"click"],["src","./Illustrations/Menu/chore_home_menu_icon.webp"],["aria-label","frequency","id","frequency","name","frequency","interface","popover","placeholder","Choisir une fr\xE9quence",3,"ngModelChange","ngModel"],["value","none"],["value","daily"],["value","weekly"],["value","monthly"],["value","yearly"],["aria-label","dueDate","id","dueDate","name","dueDate","locale","fr-FR","presentation","date",3,"ngModelChange","ngModel"],["id","open-toast",3,"click"],["trigger","open-toast","message","La t\xE2che a bien \xE9t\xE9 ajout\xE9",3,"didDismiss","buttons","duration"]],template:function(e,o){e&1&&(n(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-text",1),l(3),a()()(),n(4,"ion-content")(5,"div",2)(6,"ion-grid",3)(7,"ion-row",4)(8,"ion-col",5),g(9,re,13,1),a()(),n(10,"ion-row",4)(11,"ion-col",5),g(12,se,3,1),a()(),n(13,"ion-row",4),g(14,le,3,2),a()(),n(15,"ion-fab",6)(16,"ion-fab-button",7),h("click",function(){return o.backToCat()}),w(17,"ion-img",8),a()()()()),e&2&&(c(3),E(" ",o.taskDescription," "),c(6),_(o.task?9:-1),c(3),_(o.task?12:-1),c(2),_(o.task?14:-1))},dependencies:[I,V,R,q,F,O,z,N,L,B,X,H,K,U,W,J,j,G,P,A,Q],styles:["ion-content[_ngcontent-%COMP%]{--background: #fcf8ed}ion-toolbar.headerToolbar[_ngcontent-%COMP%]{--background: #e76f51}ion-text.headerTitle[_ngcontent-%COMP%]{color:#264653;font-family:Roboto,sans-serif;font-weight:700;font-size:1.3rem}ion-button[_ngcontent-%COMP%]{--background: #264653;--color: #fcf8ed;--border-radius: 12px;width:182px;height:58.9px;font-size:.8rem}div.editionContainer[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;height:100%}"]})};export{ae as ChoreEditionComponent};
